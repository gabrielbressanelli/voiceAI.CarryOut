<!DOCTYPE html>
<html>

    <head>

      <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

        <style>


          .offcanvas {
            --bs-offcanvas-width: 35vw; 
            max-width: 700px;  
            min-width: 400px;  
          }    

          .glass-nav {
            /* translucent fill + gentle gradient */
            background: linear-gradient(
                180deg,
                rgba(255, 255, 255, 0.75),
                rgba(255, 255, 255, 0.55)
            );
            /* blur whatever is behind the bar */
            -webkit-backdrop-filter: saturate(180%) blur(14px);
            backdrop-filter: saturate(180%) blur(14px);

            /* subtle glass edges */
            border-bottom: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow:
              0 1px 0 rgba(255, 255, 255, 0.3) inset,   /* inner highlight */
              0 10px 30px rgba(0, 0, 0, 0.08);          /* soft drop shadow */

            /* spacing and layering */
            z-index: 1030;               /* above content */
            transition: background .25s ease, backdrop-filter .25s ease, border-color .25s ease;
          }

          .glass-nav.nav-under-modal,
          .navbar.fixed-top{
            z-index: 900 !important;
          }

          body { padding-top: 6.5rem; }

          .use-sticky {
            position: sticky !important;
            top: env(safe-area-inset-top, 0) !important;
          }

          /* your fixed navbar */
          .navbar.fixed-top {
            position: fixed;            /* be explicit on iOS */
            top: env(safe-area-inset-top, 0);
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1080;              /* above offcanvas/backdrops */
            /* if using the glass look, keep a non-zero alpha background */
            background: rgba(255,255,255,0.7); /* or your glass gradient */
            -webkit-backdrop-filter: saturate(180%) blur(14px);
            backdrop-filter: saturate(180%) blur(14px);
          }

          html, body { height: 100%; }
          .main-wrapper { min-height: 100svh; }   /* or 100dvh; requires modern iOS */

          .navbar.fixed-top.nav-under-offcanvas { z-index: 1030; }

        </style>


    </head>
    <body>
        <nav class="navbar navbar-expand-lg glass-nav fixed-top ios-sticky-fallback">
          <div class="container px-4 px-lg-5">
            <!-- Always visible brand/logo -->
            <a class="navbar-brand" href="{% url 'index' %}">
              <img src="https://onesixtymain.com/wp-content/uploads/2023/06/160Main-New.png" alt="160 Main" width="220" height="68">
            </a>
      

      
            <!-- Navigation links: hide on small screens, show on large screens -->
            <div class="collapse navbar-collapse d-none d-lg-flex" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
                <li class="nav-item">
                  <a class="nav-link" aria-current="page" href="#">Appetizers</a>
                </li>
            
                <li class="nav-item">
                  <a class="nav-link" href="#Pasta">Pasta</a>
                </li>
            
                <li class="nav-item">
                  <a class="nav-link" href="#Grill">Grill</a>
                </li>
            
                <li class="nav-item">
                  <a class="nav-link" href="#Saute">Saute</a>
                </li>
            
                <li class="nav-item">
                  <a class="nav-link" href="#Seafood">Seafood</a>
                </li>
            
                <li class="nav-item">
                  <a class="nav-link" href="#Dessert">Dessert</a>
                </li>
                <!-- You can add more nav items here if needed -->
              </ul>
            </div>
      
            <!-- Offcanvas Cart Button - always visible -->
            <button class="btn btn-outline-dark d-flex align-items-center" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">
              <i class="bi-cart-fill me-1"></i>
              Cart
              <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart_quantity">
                {{ cart|length }}
              </span>
            </button>
          </div>
        </nav>
      
        <!-- Offcanvas Sidebar for Cart -->
        <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
          <div class="offcanvas-header">
            <h5 id="offcanvasRightLabel">Your Cart</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body" id="cart_summary_container">
            <div class="text-muted">Loading cart...</div>
          </div>
        </div>
      </body>

      <script>
        async function loadCartOffcanvas() {
          try {
            const res = await fetch("{% url 'cart:cart_summary' %}?t=" + Date.now(), {
              method: "GET",
              headers: { "X-Requested-With": "XMLHttpRequest" },
              credentials: "same-origin",
            });
            if (!res.ok) throw new Error("HTTP " + res.status);
            const html = await res.text();
            const target = document.getElementById("cart_summary_container");
            if (target) target.innerHTML = html;
          } catch (e) {
            console.error("Failed to load cart offcanvas:", e);
            const target = document.getElementById("cart_summary_container");
            if (target) target.innerHTML = "<div class='text-danger'>Failed to load cart.</div>";
          }
        }
        const nav = document.querySelector('.glass-nav');
        const onScroll = () => nav?.classList.toggle('scrolled', window.scrollY > 8);
        window.addEventListener('scroll', onScroll, { passive: true });
        onScroll(); // init on load


          // handle all offcanvas instances on the page

          document.addEventListener('show.bs.modal', () => {
            nav?.classList.add('nav-under-modal');
          });
          document.addEventListener('hidden.bs.modal', () => {
            nav?.classList.remove('nav-under-modal');
          });

          document.addEventListener("DOMContentLoaded", () => {
          // Load once so cart is correct on every page
          loadCartOffcanvas();

          // Refresh every time user opens the cart
          const offcanvasEl = document.getElementById("offcanvasRight");
          if (offcanvasEl) {
            offcanvasEl.addEventListener("show.bs.offcanvas", loadCartOffcanvas);
          }
        });
      </script>
      
</html>